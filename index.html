<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freedom Cabins NZ - Configurator Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        
        .test-banner {
            background: #DA8A67;
            color: white;
            text-align: center;
            padding: 0.5rem;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .header {
            background: linear-gradient(135deg, #DA8A67 0%, #c77a57 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.75rem;
            font-weight: 700;
        }
        
        .live-price {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .step-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .step-number {
            background: #DA8A67;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .step-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .cabin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1rem;
        }
        
        .cabin-card {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }
        
        .cabin-card:hover {
            border-color: #DA8A67;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(218, 138, 103, 0.15);
        }
        
        .cabin-card.selected {
            border-color: #DA8A67;
            background: #fef7f0;
        }
        
        .cabin-floorplan {
            width: 100%;
            height: 120px;
            background: #f1f5f9;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-size: 0.9rem;
            border: 1px dashed #cbd5e1;
        }
        
        .cabin-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .cabin-name {
            font-weight: 600;
            color: #1e293b;
        }
        
        .cabin-price {
            font-weight: 600;
            color: #DA8A67;
        }
        
        .cabin-specs {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 0.25rem;
        }
        
        .cabin-description {
            font-size: 0.8rem;
            color: #64748b;
        }
        
        .build-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        
        .build-option {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }
        
        .build-option:hover {
            border-color: #DA8A67;
        }
        
        .build-option.selected {
            border-color: #DA8A67;
            background: #fef7f0;
        }
        
        .build-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }
        
        .build-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }
        
        .build-price {
            color: #DA8A67;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .package-section {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .package-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
        }
        
        .package-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .preview-image {
            height: 100px;
            background: #e2e8f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-size: 0.8rem;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }
        
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
            background: white;
            color: #1e293b;
            transition: border-color 0.2s ease;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #DA8A67;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .quantity-btn {
            background: #DA8A67;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }
        
        .quantity-btn:hover {
            background: #c77a57;
        }
        
        .quantity-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        
        .quantity-display {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .sidebar {
            position: sticky;
            top: 2rem;
            height: fit-content;
        }
        
        .estimate-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .estimate-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1e293b;
            text-align: center;
        }
        
        .total-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: #DA8A67;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .price-breakdown {
            border-top: 1px solid #e2e8f0;
            padding-top: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }
        
        .price-item:last-child {
            border-top: 1px solid #e2e8f0;
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            font-weight: 600;
            color: #DA8A67;
        }
        
        .estimate-btn {
            width: 100%;
            background: linear-gradient(135deg, #DA8A67 0%, #c77a57 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .estimate-btn:hover {
            transform: translateY(-1px);
        }
        
        .estimate-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-results {
            background: #DA8A67;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .test-results.show {
            display: block;
        }
        
        @media (max-width: 1024px) {
            .layout {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: relative;
                top: 0;
            }
            
            .build-options {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .cabin-grid {
                grid-template-columns: 1fr;
            }
            
            .package-preview {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="test-banner">
        ✅ STANDALONE TEST VERSION - All functionality should work perfectly
    </div>

    <div class="header">
        <div class="header-content">
            <div class="logo">Freedom Cabins NZ</div>
            <div class="live-price" id="headerPrice">Estimate: $0 inc GST</div>
        </div>
    </div>

    <div class="container">
        <div id="testResults" class="test-results">
            <h3>✅ Test Successful!</h3>
            <p>The configurator is working correctly. You can now use this code in your Wix website.</p>
        </div>

        <div class="layout">
            <div class="main-content">
                <!-- Step 1: Choose Cabin Model -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">Choose Your Cabin Model</div>
                    </div>
                    
                    <div class="cabin-grid">
                        <div class="cabin-card" data-cabin="12x4-two-bedroom" onclick="selectCabin('12x4-two-bedroom')">
                            <div class="cabin-floorplan">12m x 4m Two Bedroom Floorplan</div>
                            <div class="cabin-info">
                                <div class="cabin-name">12m x 4m Two Bedroom</div>
                                <div class="cabin-price">$125,900</div>
                            </div>
                            <div class="cabin-specs">48m² • Kitchen • Lounge • Dining • End Bathroom • Laundry</div>
                            <div class="cabin-description">Our largest model with separate laundry and end bathroom</div>
                        </div>
                        
                        <div class="cabin-card" data-cabin="10.8x3-one-bedroom" onclick="selectCabin('10.8x3-one-bedroom')">
                            <div class="cabin-floorplan">10.8m x 3m One Bedroom Floorplan</div>
                            <div class="cabin-info">
                                <div class="cabin-name">10.8m x 3m One Bedroom</div>
                                <div class="cabin-price">$97,900</div>
                            </div>
                            <div class="cabin-specs">32.4m² • 1 Bedroom • Kitchen • Lounge • Dining • Ensuite</div>
                            <div class="cabin-description">Spacious one bedroom with ensuite bathroom</div>
                        </div>
                        
                        <div class="cabin-card" data-cabin="10x3-ensuite" onclick="selectCabin('10x3-ensuite')">
                            <div class="cabin-floorplan">10m x 3m Ensuite Floorplan</div>
                            <div class="cabin-info">
                                <div class="cabin-name">10m x 3m Ensuite Bathroom</div>
                                <div class="cabin-price">$82,900</div>
                            </div>
                            <div class="cabin-specs">30m² • 1 Bedroom • Kitchen • Lounge • Dining • Ensuite</div>
                            <div class="cabin-description">One bedroom with convenient ensuite bathroom</div>
                        </div>
                        
                        <div class="cabin-card" data-cabin="10x3-one-bedroom" onclick="selectCabin('10x3-one-bedroom')">
                            <div class="cabin-floorplan">10m x 3m One Bedroom Floorplan</div>
                            <div class="cabin-info">
                                <div class="cabin-name">10m x 3m One Bedroom</div>
                                <div class="cabin-price">$81,900</div>
                            </div>
                            <div class="cabin-specs">30m² • Kitchen • Lounge • Dining • End Bathroom & Laundry</div>
                            <div class="cabin-description">One bedroom with end bathroom and laundry area</div>
                        </div>
                        
                        <div class="cabin-card" data-cabin="7.2x3-studio" onclick="selectCabin('7.2x3-studio')">
                            <div class="cabin-floorplan">7.2m x 3m Studio Floorplan</div>
                            <div class="cabin-info">
                                <div class="cabin-name">7.2m x 3m Studio</div>
                                <div class="cabin-price">$58,900</div>
                            </div>
                            <div class="cabin-specs">21.6m² • 1 Bedroom • Kitchen • Lounge • Dining • Ensuite</div>
                            <div class="cabin-description">Compact studio with all essentials and ensuite</div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Build Type -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-title">Choose Build Type</div>
                    </div>
                    
                    <div class="build-options">
                        <div class="build-option selected" data-build="standard" onclick="selectBuildType('standard')">
                            <div class="build-icon">🏗️</div>
                            <div class="build-name">Standard Build</div>
                            <div class="build-price">Included</div>
                        </div>
                        
                        <div class="build-option" data-build="double-glazed" onclick="selectBuildType('double-glazed')">
                            <div class="build-icon">🪟</div>
                            <div class="build-name">Double Glazed</div>
                            <div class="build-price">+$8,000</div>
                        </div>
                        
                        <div class="build-option" data-build="built-to-code" onclick="selectBuildType('built-to-code')">
                            <div class="build-icon">✅</div>
                            <div class="build-name">Built to Code</div>
                            <div class="build-price">+$15,000</div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Packages & Upgrades -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-title">Packages & Upgrades</div>
                    </div>
                    
                    <!-- Bathroom Package -->
                    <div class="package-section">
                        <div class="package-title">Bathroom Package</div>
                        <div class="package-preview">
                            <div class="preview-image">Standard Bathroom<br>Basic fixtures & fittings</div>
                            <div class="preview-image">Premium Bathroom<br>Upgraded tiles & vanity</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Choose Package</label>
                            <select class="form-select" id="bathroomPackage" onchange="updatePricing()">
                                <option value="standard">Standard Bathroom (Included) - Basic fixtures & fittings</option>
                                <option value="premium">Premium Bathroom (+$2,500) - Upgraded tiles, fixtures & vanity</option>
                            </select>
                        </div>
                    </div>

                    <!-- Kitchen Package -->
                    <div class="package-section">
                        <div class="package-title">Kitchen Package</div>
                        <div class="package-preview">
                            <div class="preview-image">Standard Kitchen<br>Basic cabinetry</div>
                            <div class="preview-image">Premium Kitchen<br>Stone benchtops & premium appliances</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Choose Package</label>
                            <select class="form-select" id="kitchenPackage" onchange="updatePricing()">
                                <option value="standard">Standard Kitchen (Included) - Basic cabinetry & appliances</option>
                                <option value="premium">Premium Kitchen (+$3,500) - Stone benchtops & premium appliances</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Additional Options -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-title">Additional Options</div>
                    </div>
                    
                    <!-- Door Upgrades -->
                    <div class="form-group">
                        <label class="form-label">Door Upgrades</label>
                        <select class="form-select" id="doorType" onchange="updatePricing()">
                            <option value="standard">Standard Swing Doors (Included)</option>
                            <option value="cavity">Cavity Sliders (+$800 each)</option>
                            <option value="barn">Bespoke Barn Doors (+$1,200 each)</option>
                        </select>
                        <div class="quantity-control">
                            <span>Number of upgraded doors:</span>
                            <button class="quantity-btn" onclick="changeDoorQuantity(-1)">-</button>
                            <span class="quantity-display" id="doorQuantity">0</span>
                            <button class="quantity-btn" onclick="changeDoorQuantity(1)">+</button>
                            <span style="font-size: 0.9rem; color: #64748b;">(Max: 3)</span>
                        </div>
                    </div>

                    <!-- Cedar Panels -->
                    <div class="form-group">
                        <label class="form-label">Cedar Panel Add-on (+$600 each)</label>
                        <div class="quantity-control">
                            <span>Number of cedar panels:</span>
                            <button class="quantity-btn" onclick="changeCedarQuantity(-1)">-</button>
                            <span class="quantity-display" id="cedarQuantity">0</span>
                            <button class="quantity-btn" onclick="changeCedarQuantity(1)">+</button>
                            <span style="font-size: 0.9rem; color: #64748b;">(Max: 3)</span>
                        </div>
                    </div>

                    <!-- Trailer Option -->
                    <div class="form-group">
                        <label class="form-label">Trailer Option</label>
                        <select class="form-select" id="trailerOption" onchange="updatePricing()">
                            <option value="none">No Trailer (Cabin Only)</option>
                            <option value="single">Single Axle Trailer (+$4,500)</option>
                            <option value="double">Double Axle Trailer (+$6,000)</option>
                            <option value="triple">Triple Axle Trailer (+$7,500)</option>
                        </select>
                    </div>

                    <!-- Heat Pump -->
                    <div class="form-group">
                        <label class="form-label">Heat Pump Option</label>
                        <select class="form-select" id="heatPumpOption" onchange="updatePricing()">
                            <option value="none">No Heat Pump</option>
                            <option value="standard">Standard Heat Pump (+$2,200)</option>
                            <option value="premium">Premium Inverter Heat Pump (+$3,500)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Sidebar Estimate -->
            <div class="sidebar">
                <div class="estimate-card">
                    <div class="estimate-title">Your Estimate</div>
                    <div class="total-price" id="totalPrice">$0</div>
                    <div class="price-breakdown" id="priceBreakdown">
                        <div class="price-item">
                            <span>Select a cabin to see estimate</span>
                            <span>-</span>
                        </div>
                    </div>
                    <button class="estimate-btn" id="requestEstimateBtn" onclick="requestEstimate()" disabled>
                        Request Detailed Estimate
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Import Wix Data API for database operations
        import wixData from 'wix-data';

        // Configuration data
        const cabinData = {
            '12x4-two-bedroom': { name: '12m x 4m Two Bedroom', price: 125900 },
            '10.8x3-one-bedroom': { name: '10.8m x 3m One Bedroom', price: 97900 },
            '10x3-ensuite': { name: '10m x 3m Ensuite Bathroom', price: 82900 },
            '10x3-one-bedroom': { name: '10m x 3m One Bedroom', price: 81900 },
            '7.2x3-studio': { name: '7.2m x 3m Studio', price: 58900 }
        };

        const buildTypes = {
            'standard': { name: 'Standard Build', price: 0 },
            'double-glazed': { name: 'Double Glazed Upgrade', price: 8000 },
            'built-to-code': { name: 'Built to Code', price: 15000 }
        };

        const packages = {
            bathroom: { standard: 0, premium: 2500 },
            kitchen: { standard: 0, premium: 3500 }
        };

        const doorPrices = {
            'standard': 0,
            'cavity': 800,
            'barn': 1200
        };

        const trailerPrices = {
            'none': 0,
            'single': 4500,
            'double': 6000,
            'triple': 7500
        };

        const heatPumpPrices = {
            'none': 0,
            'standard': 2200,
            'premium': 3500
        };

        // Current configuration
        let config = {
            cabin: null,
            buildType: 'standard',
            doorQuantity: 0,
            cedarQuantity: 0
        };

        function selectCabin(cabinId) {
            console.log('✅ Cabin selection working:', cabinId);
            
            // Remove previous selection
            document.querySelectorAll('.cabin-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked cabin
            const selectedCard = document.querySelector(`[data-cabin="${cabinId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                config.cabin = cabinId;
                updatePricing();
                showTestSuccess();
            }
        }

        function selectBuildType(buildType) {
            console.log('✅ Build type selection working:', buildType);
            
            // Remove previous selection
            document.querySelectorAll('.build-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked build type
            const selectedOption = document.querySelector(`[data-build="${buildType}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
                config.buildType = buildType;
                updatePricing();
                showTestSuccess();
            }
        }

        function changeDoorQuantity(change) {
            const newQuantity = Math.max(0, Math.min(3, config.doorQuantity + change));
            config.doorQuantity = newQuantity;
            const quantityDisplay = document.getElementById('doorQuantity');
            if (quantityDisplay) {
                quantityDisplay.textContent = newQuantity;
            }
            console.log('✅ Door quantity changed to:', newQuantity);
            updatePricing();
            showTestSuccess();
        }

        function changeCedarQuantity(change) {
            const newQuantity = Math.max(0, Math.min(3, config.cedarQuantity + change));
            config.cedarQuantity = newQuantity;
            const quantityDisplay = document.getElementById('cedarQuantity');
            if (quantityDisplay) {
                quantityDisplay.textContent = newQuantity;
            }
            console.log('✅ Cedar quantity changed to:', newQuantity);
            updatePricing();
            showTestSuccess();
        }

        function updatePricing() {
            console.log('✅ Pricing update working with config:', config);
            
            let total = 0;
            const breakdown = [];

            // Base cabin price
            if (config.cabin && cabinData[config.cabin]) {
                const cabin = cabinData[config.cabin];
                total += cabin.price;
                breakdown.push({ name: cabin.name, price: cabin.price });
            }

            // Build type
            if (config.buildType && buildTypes[config.buildType]) {
                const buildType = buildTypes[config.buildType];
                if (buildType.price > 0) {
                    total += buildType.price;
                    breakdown.push({ name: buildType.name, price: buildType.price });
                }
            }

            // Bathroom package
            const bathroomSelect = document.getElementById('bathroomPackage');
            if (bathroomSelect && bathroomSelect.value === 'premium') {
                total += packages.bathroom.premium;
                breakdown.push({ name: 'Premium Bathroom Package', price: packages.bathroom.premium });
            }

            // Kitchen package
            const kitchenSelect = document.getElementById('kitchenPackage');
            if (kitchenSelect && kitchenSelect.value === 'premium') {
                total += packages.kitchen.premium;
                breakdown.push({ name: 'Premium Kitchen Package', price: packages.kitchen.premium });
            }

            // Door upgrades
            const doorSelect = document.getElementById('doorType');
            if (doorSelect && config.doorQuantity > 0) {
                const doorPrice = doorPrices[doorSelect.value] || 0;
                const doorTotal = doorPrice * config.doorQuantity;
                if (doorTotal > 0) {
                    total += doorTotal;
                    breakdown.push({ 
                        name: `Door Upgrades (${config.doorQuantity}x)`, 
                        price: doorTotal 
                    });
                }
            }

            // Cedar panels
            if (config.cedarQuantity > 0) {
                const cedarTotal = 600 * config.cedarQuantity;
                total += cedarTotal;
                breakdown.push({ 
                    name: `Cedar Panels (${config.cedarQuantity}x)`, 
                    price: cedarTotal 
                });
            }

            // Trailer option
            const trailerSelect = document.getElementById('trailerOption');
            if (trailerSelect && trailerPrices[trailerSelect.value] > 0) {
                const trailerPrice = trailerPrices[trailerSelect.value];
                total += trailerPrice;
                breakdown.push({ name: 'Trailer Option', price: trailerPrice });
            }

            // Heat pump
            const heatPumpSelect = document.getElementById('heatPumpOption');
            if (heatPumpSelect && heatPumpPrices[heatPumpSelect.value] > 0) {
                const heatPumpPrice = heatPumpPrices[heatPumpSelect.value];
                total += heatPumpPrice;
                breakdown.push({ name: 'Heat Pump', price: heatPumpPrice });
            }

            // Add GST
            const gst = Math.round(total * 0.15);
            const totalIncGST = total + gst;

            console.log('✅ Final pricing calculated - Total:', totalIncGST);

            // Update display
            const totalPriceElement = document.getElementById('totalPrice');
            const headerPriceElement = document.getElementById('headerPrice');
            
            if (totalPriceElement) {
                totalPriceElement.textContent = `${totalIncGST.toLocaleString()}`;
            }
            if (headerPriceElement) {
                headerPriceElement.textContent = `Estimate: ${totalIncGST.toLocaleString()} inc GST`;
            }

            // Update breakdown
            let breakdownHTML = '';
            if (breakdown.length > 0) {
                breakdownHTML = breakdown.map(item => `
                    <div class="price-item">
                        <span>${item.name}</span>
                        <span>${item.price.toLocaleString()}</span>
                    </div>
                `).join('');
                
                if (total > 0) {
                    breakdownHTML += `
                        <div class="price-item">
                            <span>Subtotal</span>
                            <span>${total.toLocaleString()}</span>
                        </div>
                        <div class="price-item">
                            <span>GST (15%)</span>
                            <span>${gst.toLocaleString()}</span>
                        </div>
                        <div class="price-item">
                            <span>Total inc GST</span>
                            <span>${totalIncGST.toLocaleString()}</span>
                        </div>
                    `;
                }
            } else {
                breakdownHTML = `
                    <div class="price-item">
                        <span>Select a cabin to see estimate</span>
                        <span>-</span>
                    </div>
                `;
            }

            const priceBreakdownElement = document.getElementById('priceBreakdown');
            if (priceBreakdownElement) {
                priceBreakdownElement.innerHTML = breakdownHTML;
            }

            // Enable/disable estimate button
            const estimateBtn = document.getElementById('requestEstimateBtn');
            if (estimateBtn) {
                if (config.cabin) {
                    estimateBtn.disabled = false;
                    estimateBtn.textContent = 'Request Detailed Estimate';
                } else {
                    estimateBtn.disabled = true;
                    estimateBtn.textContent = 'Select a cabin first';
                }
            }
        }

        function requestEstimate() {
            if (!config.cabin) {
                alert('Please select a cabin model first.');
                return;
            }

            // Show contact form instead of just alert
            showContactForm();
        }

        function showContactForm() {
            // Get current selections for the form
            const bathroomSelect = document.getElementById('bathroomPackage');
            const kitchenSelect = document.getElementById('kitchenPackage');
            const doorSelect = document.getElementById('doorType');
            const trailerSelect = document.getElementById('trailerOption');
            const heatPumpSelect = document.getElementById('heatPumpOption');

            const configSummary = {
                cabin: cabinData[config.cabin].name,
                buildType: buildTypes[config.buildType].name,
                bathroom: bathroomSelect ? bathroomSelect.value : 'standard',
                kitchen: kitchenSelect ? kitchenSelect.value : 'standard',
                doorType: doorSelect ? doorSelect.value : 'standard',
                doorQuantity: config.doorQuantity,
                cedarQuantity: config.cedarQuantity,
                trailer: trailerSelect ? trailerSelect.value : 'none',
                heatPump: heatPumpSelect ? heatPumpSelect.value : 'none'
            };

            // Calculate final price for the form
            let total = 0;
            if (config.cabin && cabinData[config.cabin]) {
                total += cabinData[config.cabin].price;
            }
            if (config.buildType && buildTypes[config.buildType]) {
                total += buildTypes[config.buildType].price;
            }
            if (bathroomSelect && bathroomSelect.value === 'premium') {
                total += packages.bathroom.premium;
            }
            if (kitchenSelect && kitchenSelect.value === 'premium') {
                total += packages.kitchen.premium;
            }
            if (doorSelect && config.doorQuantity > 0) {
                total += (doorPrices[doorSelect.value] || 0) * config.doorQuantity;
            }
            if (config.cedarQuantity > 0) {
                total += 600 * config.cedarQuantity;
            }
            if (trailerSelect && trailerPrices[trailerSelect.value] > 0) {
                total += trailerPrices[trailerSelect.value];
            }
            if (heatPumpSelect && heatPumpPrices[heatPumpSelect.value] > 0) {
                total += heatPumpPrices[heatPumpSelect.value];
            }
            
            const gst = Math.round(total * 0.15);
            const totalIncGST = total + gst;

            // Create and show the contact form modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 1rem;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 12px;
                    padding: 2rem;
                    max-width: 500px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                ">
                    <h2 style="color: #DA8A67; margin-bottom: 1rem; text-align: center;">
                        Request Your Detailed Estimate
                    </h2>
                    
                    <div style="background: #fef7f0; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <h3 style="color: #DA8A67; margin-bottom: 0.5rem;">Your Configuration:</h3>
                        <p><strong>${configSummary.cabin}</strong></p>
                        <p>${configSummary.buildType}</p>
                        <p style="font-size: 1.2rem; font-weight: bold; color: #DA8A67; margin-top: 0.5rem;">
                            Total: ${totalIncGST.toLocaleString()} inc GST
                        </p>
                    </div>

                    <form id="estimateForm" style="display: flex; flex-direction: column; gap: 1rem;">
                        <input type="text" id="customerName" placeholder="Your Name *" required style="
                            padding: 0.75rem;
                            border: 2px solid #e2e8f0;
                            border-radius: 6px;
                            font-size: 1rem;
                        ">
                        
                        <input type="email" id="customerEmail" placeholder="Your Email *" required style="
                            padding: 0.75rem;
                            border: 2px solid #e2e8f0;
                            border-radius: 6px;
                            font-size: 1rem;
                        ">
                        
                        <input type="tel" id="customerPhone" placeholder="Your Phone Number" style="
                            padding: 0.75rem;
                            border: 2px solid #e2e8f0;
                            border-radius: 6px;
                            font-size: 1rem;
                        ">
                        
                        <textarea id="customerMessage" placeholder="Any specific questions or requirements?" rows="3" style="
                            padding: 0.75rem;
                            border: 2px solid #e2e8f0;
                            border-radius: 6px;
                            font-size: 1rem;
                            resize: vertical;
                        "></textarea>

                        <input type="hidden" id="configData" value='${JSON.stringify(configSummary)}'>
                        <input type="hidden" id="totalPrice" value="${totalIncGST}">
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button type="button" onclick="closeContactForm()" style="
                                flex: 1;
                                padding: 1rem;
                                border: 2px solid #DA8A67;
                                background: white;
                                color: #DA8A67;
                                border-radius: 6px;
                                font-weight: 600;
                                cursor: pointer;
                            ">Cancel</button>
                            
                            <button type="submit" style="
                                flex: 2;
                                padding: 1rem;
                                border: none;
                                background: linear-gradient(135deg, #DA8A67 0%, #c77a57 100%);
                                color: white;
                                border-radius: 6px;
                                font-weight: 600;
                                cursor: pointer;
                            ">Send Estimate Request</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);

            // Handle form submission
            document.getElementById('estimateForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitEstimateRequest();
            });

            // Focus on name field
            document.getElementById('customerName').focus();
        }

        function closeContactForm() {
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) {
                modal.remove();
            }
        }

        function submitEstimateRequest() {
            const name = document.getElementById('customerName').value;
            const email = document.getElementById('customerEmail').value;
            const phone = document.getElementById('customerPhone').value;
            const message = document.getElementById('customerMessage').value;
            const configData = JSON.parse(document.getElementById('configData').value);
            const totalPrice = document.getElementById('totalPrice').value;

            // Prepare data for Wix database
            const estimateData = {
                customerName: name,
                customerEmail: email,
                customerPhone: phone,
                customerMessage: message,
                cabinModel: configData.cabin,
                buildType: configData.buildType,
                bathroomPackage: configData.bathroom,
                kitchenPackage: configData.kitchen,
                doorType: configData.doorType,
                doorQuantity: configData.doorQuantity,
                cedarQuantity: configData.cedarQuantity,
                trailerOption: configData.trailer,
                heatPumpOption: configData.heatPump,
                totalPrice: parseInt(totalPrice),
                submittedDate: new Date(),
                status: 'new'
            };

            // Save to Wix database
            wixData.insert("CabinEstimates", estimateData)
                .then((result) => {
                    showSuccessMessage(estimateData, result._id);
                    closeContactForm();
                })
                .catch((error) => {
                    console.error('Error saving estimate:', error);
                    alert('Sorry, there was an error submitting your request. Please try again or contact us directly.');
                });
        }

        function showSuccessMessage(estimateData, estimateId) {
            // Create and show success message
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 1001;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 1rem;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 12px;
                    padding: 2rem;
                    max-width: 500px;
                    width: 100%;
                    text-align: center;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                ">
                    <div style="
                        width: 60px;
                        height: 60px;
                        background: #DA8A67;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin: 0 auto 1rem;
                        color: white;
                        font-size: 24px;
                    ">✓</div>
                    
                    <h2 style="color: #DA8A67; margin-bottom: 1rem;">
                        Estimate Request Submitted!
                    </h2>
                    
                    <p style="color: #64748b; margin-bottom: 1rem; line-height: 1.6;">
                        Thank you ${estimateData.customerName}! We've received your request for a 
                        <strong>${estimateData.cabinModel}</strong> cabin.
                    </p>
                    
                    <div style="
                        background: #fef7f0;
                        padding: 1rem;
                        border-radius: 8px;
                        margin-bottom: 1.5rem;
                        text-align: left;
                    ">
                        <p style="color: #DA8A67; font-weight: 600; margin-bottom: 0.5rem;">
                            Reference: ${estimateId}
                        </p>
                        <p style="color: #64748b; font-size: 0.9rem;">
                            Estimated Total: $${estimateData.totalPrice.toLocaleString()} inc GST
                        </p>
                    </div>
                    
                    <p style="color: #64748b; margin-bottom: 1.5rem; font-size: 0.9rem;">
                        We'll contact you within 24 hours with your detailed estimate 
                        and answer any questions you have.
                    </p>
                    
                    <button onclick="closeSuccessMessage()" style="
                        background: linear-gradient(135deg, #DA8A67 0%, #c77a57 100%);
                        color: white;
                        border: none;
                        padding: 1rem 2rem;
                        border-radius: 6px;
                        font-weight: 600;
                        cursor: pointer;
                        font-size: 1rem;
                    ">Continue</button>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function closeSuccessMessage() {
            const modal = document.querySelector('div[style*="z-index: 1001"]');
            if (modal) {
                modal.remove();
            }
        }

        function showTestSuccess() {
            const testResults = document.getElementById('testResults');
            if (testResults) {
                testResults.classList.add('show');
            }
        }

        // Initialize the configurator
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ Configurator initialized successfully');
            
            // Set initial quantities
            const doorQuantityElement = document.getElementById('doorQuantity');
            const cedarQuantityElement = document.getElementById('cedarQuantity');
            
            if (doorQuantityElement) {
                doorQuantityElement.textContent = '0';
            }
            if (cedarQuantityElement) {
                cedarQuantityElement.textContent = '0';
            }
            
            // Initial pricing update
            updatePricing();
            
            console.log('✅ All systems ready - test the configurator now!');
        });
    </script>
</body>
</html>
